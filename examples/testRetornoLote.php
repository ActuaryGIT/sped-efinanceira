<?php
error_reporting(E_ALL);
ini_set('display_errors', 'On');
include_once '../bootstrap.php';

use NFePHP\eFinanc\Response;

//$xml = file_get_contents('20160428181800-retEnviaLote.xml');
$xml = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Header><WSCorIDSOAPHeader CorID="637B02F2BD094366034EBEB249FDA615,1:2,0,0,,,AgAAAj1IQgAAAAFGAAAAAQAAABFqYXZhLnV0aWwuSGFzaE1hcAAAAAhIQgAAAAJGAAAAAgAAABBqYXZhLmxhbmcuU3RyaW5nABBBcHBNYXBDYWxsZXJIb3N0SEIAAAADRQAAAAIADFNQQ0RTUlZWMjEwNEhCAAAABEUAAAACABBBcHBNYXBDYWxsZXJUeXBlSEIAAAAFRQAAAAIAB1NlcnZsZXRIQgAAAAZFAAAAAgAKVHhuVHJhY2VJZEhCAAAAB0UAAAACACE2MzdCMDJFMkJEMDk0MzY2MDM0RUJFQjI1RjEyMTNEMTBIQgAAAAhFAAAAAgARQXBwTWFwQ2FsbGVyQWdlbnRIQ0hCAAAACUUAAAACAA5BcHBNYXBBcHBOYW1lc0hCAAAACkYAAAADAAAAE2phdmEudXRpbC5BcnJheUxpc3QAAAACSEIAAAALRQAAAAIADVdzZUZpbmFuY2VpcmFIQgAAAAxFAAAAAgANV3NlRmluYW5jZWlyYUhCAAAADUUAAAACABZBcHBNYXBDYWxsZXJNZXRob2ROYW1lSEIAAAAORQAAAAIAJVN5bmNTZXNzaW9ubGVzc0hhbmRsZXJ8UHJvY2Vzc1JlcXVlc3RIQgAAAA9FAAAAAgATQXBwTWFwQ2FsbGVyUHJvY2Vzc0hCAAAAEEUAAAACAAwuTkVUIFByb2Nlc3NIQgAAABFFAAAAAgAPQ2FsbGVyVGltZXN0YW1wSEIAAAASRQAAAAIADTE0NjE5NTc4ODY4MDA=" xmlns="http://www.wilytech.com/" /></soap:Header><soap:Body><ReceberLoteEventoResult xmlns="http://sped.fazenda.gov.br/"><eFinanceira xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.eFinanceira.gov.br/schemas/retornoLoteEventos/v1_0_1"><retornoLoteEventos id="D56162D090257A8868DB912347BE550A"><ideTransmissor><IdTransmissor>75156034000179</IdTransmissor></ideTransmissor><status><cdStatus>0</cdStatus><descRetorno>SUCESSO</descRetorno></status><retornoEventos><evento id="ID0"><eFinanceira xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.eFinanceira.gov.br/schemas/retornoEvento/v1_0_1"><retornoEvento id="ID000000000000000006"><identificacaoEmpresaDeclarante><cnpjEmpresaDeclarante>75156034000179</cnpjEmpresaDeclarante></identificacaoEmpresaDeclarante><dadosRecepcaoEvento><dhProcessamento>2016-04-29T16:24:46.7133929-03:00</dhProcessamento><tipoEvento>006</tipoEvento><idEvento>ID000000000000000006</idEvento><hash>pfdRxbcGv2kzqIADMWGfXKi5bB268g58tL3BcWHH2v4=</hash></dadosRecepcaoEvento><status><cdRetorno>1</cdRetorno><descRetorno>ERRO</descRetorno><dadosRegistroOcorrenciaEvento><ocorrencias><tipo>1</tipo><localizacaoErroAviso /><codigo>MS1082</codigo><descricao>Não é possível excluir o Evento de Movimentação, uma vez que não existe e-Financeira em andamento para o período.</descricao></ocorrencias></dadosRegistroOcorrenciaEvento></status></retornoEvento><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315" /><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig-more#rsa-sha256" /><Reference URI="#ID000000000000000006"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" /><Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315" /></Transforms><DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256" /><DigestValue>icsSzL0lEofr9DxbiPLrboS/t0FL2jazHg0fY4SGUdI=</DigestValue></Reference></SignedInfo><SignatureValue>h3H1RvOPfKSZW74f/OcMcd6LsJAvlRVF8ZaUXPpKVmLiLIf0/9cMKn5xSp+2Fs9F5pEqJFRk+B9sLmVyz+NeRsEPTdDPC9a4wWCAc9nzJ38Sn6CNY9RKlKYPa4XKSkRre6IvWeRflfMjI3nkJy6q4G91TwkQpf4gLe35O4oz5hC54UcGy+8fwWFgxbC3sfajtH+RdIzQkSo1MQtssggsEu2smzH/zE4mHNvpUMqP0e3LlcVr5GTlasxDEDlZE8ai7vdaf2Wl/tpsQxvA7A6dt5fLKkqK0rxk1iZsSkiKsFNS9BBPaz4sR9bI8X+VG5we2bmr8TMoaoSLOWa4RwTezw==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></eFinanceira></evento></retornoEventos></retornoLoteEventos><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315" /><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig-more#rsa-sha256" /><Reference URI="#D56162D090257A8868DB912347BE550A"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" /><Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315" /></Transforms><DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256" /><DigestValue>TPb2dXaYcNhiFb/pfIt0k8sMgHr4RFt6MQF3LAhe//4=</DigestValue></Reference></SignedInfo><SignatureValue>tTa8T2Ga11IqmQC9RweLEYMDZEiiQQ4BgdzBnpgVDE7n8DJx58c/gpp+UIf41aL8bGxaRsa72Mo2r8LqILYs4r2YooMbH/vQWIINJM0atfHyhAfjnrDsR8sQd0OZkoxZl87cpSwG0Ku2PJDqf+C48vebnfJ/5L05nm9LMmyHQ5K05hYGFOMAod6IHJskyW9RqEY+sPA7+4KNNCQpA+3FAXxT0aAKRywMr81iMBlzWrtRNTruVAcD5OjOqbE5Pyy0Uw2s96MO+nWmwGMGGd6Qot1olLpUM18uxMznVMn4tpfz0zGZmgCImMItuVkRNhw88GJJwaU/5UhQuN+pgcSEEQ==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></eFinanceira></ReceberLoteEventoResult></soap:Body></soap:Envelope>';
$method = 'ReceberLoteEvento';
$resp = Response::readReturn($method, $xml);

var_dump($resp);